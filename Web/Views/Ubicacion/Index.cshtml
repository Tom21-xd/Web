@using Microsoft.AspNetCore.Identity;

@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var cont = 1;

}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionar Ubicaciones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

    <style>
        input {
            width: 100px;
        }
    </style>
</head>

<body style="background-color: rgb(207, 207, 207);">
    <div class="container" style="margin-top: 25px;padding: 5px ;margin-left:300px; width:80%">
        <h1 class="ml-3 mb-5" style="color:#255000;">Gestionar Ubicaciones</h1>

        <div>
            <label for="pisos">Pisos</label>
            <input id="numPisos" type="number" min="1" value="@ViewBag.pisos.Count">

            <label for="bloques">Bloques</label>
            <input id="numBloques" type="number" min="1" value="@ViewBag.bloques.Count">
            <button id="botonGuardar" class="btn btn-primary" disabled>Guardar Cambios</button>
        </div>

        <div class="table-responsive mt-3">
            <div style="width:1000px;">
                <table id="tabla" class="table-bordered align-middle border-success mt-3">
                    <thead>
                        <th style=" width:150px;" class="text-center">Bloque</th>
                        @foreach (PisoModel piso in ViewBag.pisos)
                        {
                            <th style=" width:150px; text-align: center" class="text-center">Piso @piso.Id</th>
                        }
                    </thead>

                    <tbody>

                        @foreach (BloqueModel bloque in ViewBag.bloques)
                        {
                            <tr>
                                <td class="text-center">@cont</td>
                                @foreach (PisoModel piso in ViewBag.pisos)
                                {
                                    <td class="text-center">
                                        <input class="text-center" type="checkbox">
                                    </td>
                                }
                            </tr>
                            cont++;
                        }
                        @{
                            cont = 1;
                        }
                    </tbody>
                </table>
            </div>



        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous">
    </script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js">
    </script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>

    <script>
        var nump = document.getElementById("numPisos");
        var numb = document.getElementById("numBloques");
        var btn = document.getElementById("botonGuardar");
        var tabla = document.getElementById("tabla");

        function habilitarBoton(){
            if (parseInt(nump.value) == @((int)ViewBag.pisos.Count) && parseInt(numb.value) == @((int)ViewBag.bloques.Count)) {
                btn.disabled = true;
            } else {
                btn.disabled = false;
            }
        }

        function insertarFilas(){
            var numf = @((int)ViewBag.bloques.Count);
            var numc = @((int)ViewBag.pisos.Count);
            var f = numf - parseInt(numb.value);
            var c = numc - parseInt(nump.value);
            
            var op = numc;
            if (c > 0){
                for (var i = 0; i < c; i++){
                    window.location.href = "@Url.Action("eliminarPiso","Ubicacion")" + "?id=" + op;
                    for (var j = 0; j <= parseInt(numb.value); j++){
                        tabla.rows[j].cells[op].style.display = 'none';
                    }
                    op--;
                }
            } else if (c < 0){
                c *= -1;
                if (parseInt(nump.value) > numc){
                    var estiloTh = {
                        width: '150px'
                    };
                    for (var i = 0; i < c; i++) {
                        window.location.href = "@Url.Action("crearPiso","Ubicacion")" + "?nombre=" + op.toString();
                        var nuevoTh = document.createElement('th');
                        nuevoTh.textContent = "Piso " + (op + 1);
                        nuevoTh.classList.add('text-center');

                        Object.assign(nuevoTh.style, estiloTh);

                        tabla.rows[0].insertCell(op + 1).appendChild(nuevoTh);
                        for (var j = 1; j <= parseInt(numb.value); j++) {
                            tabla.rows[j].insertCell(-1);
                            var checkbox = document.createElement("input");
                            checkbox.type = "checkbox";
                            tabla.rows[j].cells[op + 1].appendChild(checkbox);
                        }
                        op++;
                    }
                }
            }
            op = numf;
            if (f > 0) {
                for (var i = 0; i < f; i++) {
                    window.location.href = "@Url.Action("eliminarBloque","Ubicacion")" + "?id=" + op;
                    tabla.deleteRow(op);
                    op--;
                }
            } else if (f < 0) {
                f *= -1;
                for (var i = 0; i < f; i++) {
                    op++;
                    window.location.href = "@Url.Action("crearBloque","Ubicacion")" + "?nombre=" + op.toString();
                    tabla.insertRow();

                    tabla.rows[op].insertCell(0);
                    tabla.rows[op].cells[0].innerHTML = op;
                    tabla.rows[op].cells[0].style.textAlign = 'center';
                    for (var j = 1; j <= numc; j++){
                        tabla.rows[op].insertCell(-1);
                        var checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        tabla.rows[op].cells[j].appendChild(checkbox);
                        tabla.rows[op].cells[j].style.textAlign = 'center';
                    }
                }
            }

        }

        btn.addEventListener('click', insertarFilas);
        nump.addEventListener('input', habilitarBoton);
        numb.addEventListener('input', habilitarBoton);
        
    </script>

</body>
</html>

